## 1. 进程的概念

**定义：**

[![img](https://camo.githubusercontent.com/14ba2eb87682b919e8d790b5c9977a3ea43af4df79a98374ebc5a79d5c882f42/68747470733a2f2f706963332e7a68696d672e636f6d2f38302f76322d38326638376130623562343830653261313339343436366533366632663462355f31343430772e6a706567)](https://camo.githubusercontent.com/14ba2eb87682b919e8d790b5c9977a3ea43af4df79a98374ebc5a79d5c882f42/68747470733a2f2f706963332e7a68696d672e636f6d2f38302f76322d38326638376130623562343830653261313339343436366533366632663462355f31343430772e6a706567)

程序是静态的，进程是动态的。进程 = 程序+执行状态。进程有核心态、用户态。

##### 1.1 进程的组成：

进程包含了正在运行的程序的所有状态信息。

- 代码
- 数据
- 状态寄存器（敏感寄存器，如指令指针IP）
- 32个通用寄存器
- 进程占用系统资源（打开文件、已分配内存...）

进程的特点：

- 动态性：可动态创建/结束进程
- 并发性：进程可以被独立调度并占用处理机运行（宏观上并发执行，微观上交替执行）
- 独立性：不同进程工作不互相影响（隔离）
- 制约性：因访问共享数据、资源或进程间同步而产生制约

### 2. 进程控制块(PCB)

进程对应的唯一标识。

[![img](https://camo.githubusercontent.com/a9c6c975b8b4a47d2a9cc660dd668b2b1f2fe480dcc56bb38c103f554a9a5d58/68747470733a2f2f706963332e7a68696d672e636f6d2f38302f76322d36663639303963313034396133663433323430393434386361343462353566635f31343430772e6a706567)](https://camo.githubusercontent.com/a9c6c975b8b4a47d2a9cc660dd668b2b1f2fe480dcc56bb38c103f554a9a5d58/68747470733a2f2f706963332e7a68696d672e636f6d2f38302f76322d36663639303963313034396133663433323430393434386361343462353566635f31343430772e6a706567)

### 3. 进程状态

进程的生命周期划分

- 创建
- 执行：内核选一个就绪的进程，让它占用处理机执行。如何选择呢？这就要涉及调度算法了。
- 等待：当条件不满足，比如等待数据/资源不够。自己进入等待状态。
- 抢占：高优先级进程就绪，直接开始运行。或者，进程执行当前时间片用完。
- 唤醒：阻塞进程需要的资源可以被满足，等待的事件到达。只能由其他进程/操作系统来唤醒。
- 结束

三状态进程模型：

- 运行状态
- 就绪状态：进程获得除处理机外所有资源，得到处理机即可运行；
- 等待状态：因等待某一事件而暂停运行

挂起进程模型：

之前的三状态进程模型，是和CPU相关的；“进程挂起”是和**存储**相关的。处在挂起状态的进程映像在磁盘(外存)上，目的是减少进程占用内存。“挂起”状态就是指**进程在外存中**的状态。

### 4. 线程

为什么要引入线程呢？这是因为，一个进程内部，我们往往希望其具有并发性。所以，在进程内部增加一类实体，满足：

- 实体之间可以**并发**执行；
- 实体之间**共享**相同的地址空间，这样信息交流方便，不用隔离。（而进程的目的就是隔离而不是共享）

这样的实体就是线程。

【定义】线程是进程中**指令执行流**的基本单元，是**CPU调度**的基本单位。

![img](https://pic1.zhimg.com/80/v2-2adfca446d4e7f7530641f6d794d97bb_1440w.jpeg)

【线程与进程比较】

- 进程是**资源分配**的基本单位（**代码+数据+打开文件**），线程是**CPU调度**的基本单位，描述**指令流执行状态**（**寄存器+堆栈**）
- 进程拥有一个完整的资源平台，而线程只独享指令流执行的必要资源，如寄存器和栈。
- 线程的创建、结束、切换时间都比线程短
- 由于同一进程的各个线程共享内存和文件资源，可不通过内核直接通信。

线程的缺点：没有隔离，如果一个线程异常，改了其他线程的信息，会导致其他线程都运行不了，整个进程崩溃。

【线程的实现方式】

- 用户线程：内核不了解用户线程的存在，因此可用于不支持线程的多进程操作系统；每个进程有私有的线程控制块(TCB)列表，每个进程有自己的线程调度算法；同一进程内的用户线程不需要用户态、核心态切换。

![img](https://pic3.zhimg.com/80/v2-4e5d3486d93cf51aca5e2dbd95f82853_1440w.jpeg)

- 内核线程：由内核通过系统调用来完成线程的创建、终止、管理。

### 5. 协程

- 同步函数：当一个函数是同步执行时，当该函数被调用时不会立即返回，直到该函数所要做的事情全都做完了才会返回。
- 异步函数：一个异步函数被调用，函数会立即返回；当该函数规定的操作任务完成时，通过回调、事件或者消息机制将结果通知给调用者。

协程的工作原理：

- 当协程执行出现阻塞时（yield，将控制权返回给该协程的创建协程），由协程调度器主动保存当前栈上数据，让出权给其他可执行协程。
- 阻塞完之后再通过协程调度器恢复栈上数据，并恢复原协程执行。

协程和函数的关系：

![img](https://pic2.zhimg.com/80/v2-8b2ce1584b1d15961a862469e3cd1f4e_1440w.jpeg)

协程和进程的关系：

![3cda6d9cec5ab1d3f086ee6c1d18fb6](C:\Users\zh-wa\AppData\Local\Temp\WeChat Files\3cda6d9cec5ab1d3f086ee6c1d18fb6.jpg)

协程的切换

![3942e3e882f9625e3918f7ac96ee597](C:\Users\zh-wa\AppData\Local\Temp\WeChat Files\3942e3e882f9625e3918f7ac96ee597.jpg)

Python对协程的支持是通过**generator**实现的。



一句话概括协程的好处：让原来需要使用异步+回调方式写的非人类代码，用看似同步的方法写出来...

